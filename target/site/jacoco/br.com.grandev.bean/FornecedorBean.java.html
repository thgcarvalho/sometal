<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>FornecedorBean.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Sometal WebApp</a> &gt; <a href="index.html" class="el_package">br.com.grandev.bean</a> &gt; <span class="el_source">FornecedorBean.java</span></div><h1>FornecedorBean.java</h1><pre class="source lang-java linenums">package br.com.grandev.bean;

import static br.com.grandev.util.FacesUtils.MSG_ERROR;
import static br.com.grandev.util.FacesUtils.MSG_SUCESS;
import static br.com.grandev.util.FacesUtils.addErrorMessage;
import static br.com.grandev.util.FacesUtils.addInfoMessage;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import javax.annotation.PostConstruct;
import javax.annotation.Resource;
import javax.faces.bean.ManagedBean;
import javax.faces.bean.ViewScoped;

import org.primefaces.event.FlowEvent;

import br.com.grandev.dao.FornecedorDao;
import br.com.grandev.daoImp.FornecedorDaoImp;
import br.com.grandev.model.Fornecedor;

/**
 * @author Thiago Carvalho
 * 
 */
@ManagedBean
@ViewScoped
<span class="nc" id="L30">public class FornecedorBean implements Serializable {</span>

	private static final long serialVersionUID = 1L;

	@Resource(name = &quot;fornecedorDao&quot;)
	private FornecedorDao fornecedorDao;
	private Fornecedor fornecedor;
	private Fornecedor fornecedorSelecionado;
	private List&lt;Fornecedor&gt; listaFornecedores;
	private List&lt;Fornecedor&gt; filteredFornecedores;
<span class="nc" id="L40">	private String oferta = new String();</span>
	
	@PostConstruct
	public void init() {
<span class="nc" id="L44">		fornecedor = new Fornecedor();</span>
<span class="nc" id="L45">		fornecedorDao = new FornecedorDaoImp();</span>
<span class="nc" id="L46">		carregaFornecedores();</span>
<span class="nc" id="L47">	}</span>
	
	public void preparaNovoFornecedor() {
<span class="nc" id="L50">		fornecedor = new Fornecedor();</span>
<span class="nc" id="L51">	}</span>
	
	public void carregaFornecedores() {
<span class="nc" id="L54">		fornecedor = new Fornecedor();</span>
<span class="nc" id="L55">		listaFornecedores = new ArrayList&lt;Fornecedor&gt;();</span>
		try {
<span class="nc" id="L57">			listaFornecedores = fornecedorDao.fornecedores();</span>
<span class="nc" id="L58">		} catch (Exception e) {</span>
<span class="nc" id="L59">			e.printStackTrace();</span>
<span class="nc" id="L60">		}</span>
<span class="nc" id="L61">		filteredFornecedores = listaFornecedores;</span>
<span class="nc" id="L62">	}</span>
	
	public String editar() {
<span class="nc" id="L65">		boolean erro = false;</span>
<span class="nc" id="L66">		String erroMsg = null;</span>
		try {
<span class="nc" id="L68">			preparaFornecedor(fornecedorSelecionado);</span>
<span class="nc" id="L69">			fornecedorDao.editar(fornecedorSelecionado);</span>
<span class="nc" id="L70">		} catch (Exception e) {</span>
<span class="nc" id="L71">			erro = true;</span>
<span class="nc" id="L72">			erroMsg = e.getMessage();</span>
<span class="nc" id="L73">			e.printStackTrace();</span>
<span class="nc" id="L74">		}</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">		if (erro) {</span>
<span class="nc" id="L76">			addErrorMessage(MSG_ERROR, erroMsg);</span>
<span class="nc" id="L77">			return &quot;&quot;;</span>
		} else {
<span class="nc" id="L79">			addInfoMessage(MSG_SUCESS);</span>
<span class="nc" id="L80">			carregaFornecedores();</span>
<span class="nc" id="L81">			return &quot;fornecedores&quot;;</span>
		}
	}
	
	public String criar() {
<span class="nc" id="L86">		boolean erro = false;</span>
<span class="nc" id="L87">		String erroMsg = null;</span>
		try {
<span class="nc" id="L89">			preparaFornecedor(fornecedor);</span>
<span class="nc" id="L90">			fornecedorDao.criar(fornecedor);</span>
<span class="nc" id="L91">			fornecedor = new Fornecedor();</span>
<span class="nc" id="L92">			oferta = new String();</span>
<span class="nc" id="L93">			carregaFornecedores();</span>
<span class="nc" id="L94">		} catch (Exception e) {</span>
<span class="nc" id="L95">			erro = true;</span>
<span class="nc" id="L96">			erroMsg = e.getMessage();</span>
<span class="nc" id="L97">			e.printStackTrace();</span>
<span class="nc" id="L98">		}</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">		if (erro) {</span>
<span class="nc" id="L100">			addErrorMessage(MSG_ERROR, erroMsg);</span>
<span class="nc" id="L101">			return &quot;&quot;;</span>
		} else {
<span class="nc" id="L103">			addInfoMessage(MSG_SUCESS);</span>
<span class="nc" id="L104">			carregaFornecedores();</span>
<span class="nc" id="L105">			return &quot;fornecedores&quot;;</span>
		}
	}

	public String excluir() {
<span class="nc" id="L110">		boolean erro = false;</span>
<span class="nc" id="L111">		String erroMsg = null;</span>
		try {
<span class="nc" id="L113">			fornecedorDao.excluir(fornecedorSelecionado);</span>
<span class="nc" id="L114">		} catch (Exception e) {</span>
<span class="nc" id="L115">			erro = true;</span>
<span class="nc" id="L116">			erroMsg = e.getMessage();</span>
<span class="nc" id="L117">			e.printStackTrace();</span>
<span class="nc" id="L118">		}</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">		if (erro) {</span>
<span class="nc" id="L120">			addErrorMessage(MSG_ERROR, erroMsg);</span>
<span class="nc" id="L121">			return &quot;&quot;;</span>
		} else {
<span class="nc" id="L123">			addInfoMessage(MSG_SUCESS);</span>
<span class="nc" id="L124">			carregaFornecedores();</span>
<span class="nc" id="L125">			return &quot;fornecedores&quot;;</span>
		}
	}
	
	private void preparaFornecedor(Fornecedor fornecedor) {
<span class="nc" id="L130">		fornecedor.setNome(fornecedor.getNome().trim());</span>
<span class="nc" id="L131">		String todasAsOfertas = &quot;&quot;;</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">		for (int i = 0; i &lt; fornecedor.getOfertas().size(); i++) {</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">			if (i &lt; 10) {</span>
<span class="nc" id="L134">				todasAsOfertas += fornecedor.getOfertas().get(i) + &quot;&lt;br /&gt;&quot;;</span>
			}
		}
<span class="nc" id="L137">		fornecedor.setOferta(todasAsOfertas);</span>
<span class="nc" id="L138">	}</span>
	
	// getters and setters

	public FornecedorDao getFornecedorDao() {
<span class="nc" id="L143">		return fornecedorDao;</span>
	}

	public void setFornecedorDao(FornecedorDao fornecedorDao) {
<span class="nc" id="L147">		this.fornecedorDao = fornecedorDao;</span>
<span class="nc" id="L148">	}</span>

	public Fornecedor getFornecedor() {
<span class="nc bnc" id="L151" title="All 2 branches missed.">		if (fornecedor == null) {</span>
<span class="nc" id="L152">			fornecedor = new Fornecedor();</span>
		}
<span class="nc" id="L154">		return fornecedor;</span>
	}

	public void setFornecedor(Fornecedor fornecedor) {
<span class="nc" id="L158">		this.fornecedor = fornecedor;</span>
<span class="nc" id="L159">	}</span>
	
	public Fornecedor getFornecedorSelecionado() {
<span class="nc" id="L162">		return fornecedorSelecionado;</span>
	}

	public void setFornecedorSelecionado(Fornecedor fornecedorSelecionado) {
		// copia a lista para evitar org.hibernate.LazyInitializationException: 
		// failed to lazily initialize a collection, no session or session was closed
<span class="nc bnc" id="L168" title="All 2 branches missed.">		if (fornecedorSelecionado != null) {</span>
<span class="nc" id="L169">			fornecedorSelecionado.setOfertas(fornecedorSelecionado.getOfertasDB());</span>
		}
<span class="nc" id="L171">		this.fornecedorSelecionado = fornecedorSelecionado;</span>
<span class="nc" id="L172">	}</span>
	
	public List&lt;Fornecedor&gt; getFornecedores() {
<span class="nc" id="L175">		return listaFornecedores;</span>
	}

	public void setFornecedores(List&lt;Fornecedor&gt; listaFornecedores) {
<span class="nc" id="L179">		this.listaFornecedores = listaFornecedores;</span>
<span class="nc" id="L180">	}</span>
	
    public List&lt;Fornecedor&gt; getFilteredFornecedores() {  
<span class="nc" id="L183">        return filteredFornecedores;  </span>
    }  
  
    public void setFilteredFornecedores(List&lt;Fornecedor&gt; filteredFornecedores) {  
<span class="nc" id="L187">        this.filteredFornecedores = filteredFornecedores;  </span>
<span class="nc" id="L188">    }</span>
    
    public String reinit() {  
<span class="nc" id="L191">    	oferta = new String();  </span>
<span class="nc bnc" id="L192" title="All 4 branches missed.">    	if (fornecedor != null &amp;&amp; fornecedor.getOfertas() != null) {</span>
    		String oferta;
<span class="nc bnc" id="L194" title="All 2 branches missed.">    		for (Iterator&lt;String&gt; iterator = fornecedor.getOfertas().iterator(); iterator.hasNext();) {</span>
<span class="nc" id="L195">    			oferta = iterator.next();</span>
<span class="nc bnc" id="L196" title="All 4 branches missed.">    			if (oferta == null || oferta.equals(&quot;&quot;)) {</span>
<span class="nc" id="L197">    				iterator.remove();</span>
    			}
    		}
    	}
<span class="nc bnc" id="L201" title="All 4 branches missed.">    	if (fornecedorSelecionado != null &amp;&amp; fornecedorSelecionado.getOfertas() != null) {</span>
    		String oferta;
<span class="nc bnc" id="L203" title="All 2 branches missed.">    		for (Iterator&lt;String&gt; iterator = fornecedorSelecionado.getOfertas().iterator(); iterator.hasNext();) {</span>
<span class="nc" id="L204">    			oferta = iterator.next();</span>
<span class="nc bnc" id="L205" title="All 4 branches missed.">    			if (oferta == null || oferta.equals(&quot;&quot;)) {</span>
<span class="nc" id="L206">    				iterator.remove();</span>
    			}
    		}
    	}
<span class="nc" id="L210">        return null;  </span>
    }  
  
    public String getOferta() {  
<span class="nc" id="L214">        return oferta;  </span>
    }  
  
    public void setOferta(String oferta) {  
<span class="nc" id="L218">        this.oferta = oferta;  </span>
<span class="nc" id="L219">    }</span>
	
	public String onFlowProcess(FlowEvent event) {
<span class="nc" id="L222">			return event.getNewStep();</span>
	}
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.2.201302030002</span></div></body></html>